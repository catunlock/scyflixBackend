<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SCYFLIX</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- Custom fonts for this template -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Cabin:700' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="css/grayscale.min.css" rel="stylesheet">
    <link href="css/manolito.css" rel="stylesheet">
    <script>

    	var searchResults;

    	function showTopic(s)
		{
		   var topics = '#topics'+s;
		   $(topics).show();
		}

		function hideTopic(s)
		{
		   var topics = '#topics'+s;
		   $(topics).hide();
		}
		var psr = '#resultados';
		$(psr).hide();
	    var x = document.cookie; 
	    var userName = x.substring(9, x.length);
	    var url = 'http://localhost:3000/getFirstRecomendation?user='+userName;
	    jQuery.support.cors = true;
	    $.ajax ({
	        url: url,
	        datatype: "json",
	        crossDomain: true,
	        success: function (data) {

				var i;
				var html ='<div class="carousel-inner" style = "min-height: 1000px;"><div class="item active">';
				for (i=0; i < data.length && i < 3; ++i){
					var image1 = './images/'+data[i].paper.id+'.jpg';
					var pdf1 = './pdfs/'+data[i].paper.id+'.pdf';
					if (i != 0) html = html+'<div class="item">';
					html = html + '<img onclick="clickImage('+data[i].paper.id+');" src="'+image1+'" style="width: 100%"></div></a>';
				}
				html = html + '</div>';
				document.getElementById("carrousel").innerHTML = html;
	        }
	    })

	    function getRelated(j,id){
	    	/*
	    	var url = 'http://localhost:3000/getThreeSimilar?paper='+id;
		    jQuery.support.cors = true;
		    $.ajax ({
		        url: url,
		        datatype: "json",
		        crossDomain: true,
		        success: function (data) {

					var i;
					var html ='<div id="myCarousel'+id+'" class="carousel slide" data-ride="carousel"><div class="carousel-inner"><div class="item active">';
					for (i=0; i < data.length && i < 3; ++i){
						var image1 = './images/'+data[i].paper.id+'.jpg';
						var pdf1 = './pdfs/'+data[i].paper.id+'.pdf';
						if (i != 0) html = html+'<div class="item">';
						html = html + '<img onclick="clickImage('+data[i].paper.id+');" src="'+image1+'" style="width: 100%"></div></a>';
					}
					html = html + '</div></div>';
					document.getElementById('carrousel'+j).innerHTML = html;
		        }
		    })	*/
	    }
	    function clickImage(a) {
	      var paperId = a;
	      var x = document.cookie; 
	      var userName = x.substring(9, x.length);
	      var url = 'http://localhost:3000/updateLastPaper?user='+userName+'&paper='+paperId;
	      jQuery.support.cors = true;
	      $.ajax ({
	          url: url,
	          datatype: "json",
	          crossDomain: true,
	          success: function (data) {
	            alert("DB updated");
	          }
	      })
	      var win = window.open(dict[a], '_blank');
	      win.focus();
	    }

	    function showPaper(i, id){
	    	getRelated(i,id);
			var p = '#paper'+i;
			$(p).show();
	    }

	    function hidePaper(i){
			var p = '#paper'+i;
			$(p).hide();
	    }
	    function searchSimilar(){
	    	var path = './testPdfs/'+document.getElementById("fileInput").files[0].name; //POR MOTIVOS DE SEGURIDAD EL EXPLORADOR NO TE DEVUELVE LA RUTA, HABRA QUE ESCOGER PAPERS QUE ESTEN EN EL DIRECTORIO ./testPdfs
	    	alert('Find similar to '+path);
			/*var url = 'http://localhost:3000/getSimilarFromPdf?file='+path;
			jQuery.support.cors = true;
			$.ajax ({
				url: url,
				datatype: "json",
				crossDomain: true,
			success: function (data) {
						var i;
						var html = "";
						for (i = 0; i < data.length; ++i){
							html = html + '<div onmouseover="showPaper('+i+', \''+data[i].id+'\');" onmouseout="hidePaper('+i+');"  id = "'+data[i].id+'" class="btn-inner" style ="margin-top:20px; font-size: 3rem;">';
      						html = html + '· '+data[i].title;
      						html = html + '<div id="paper'+i+'" class="btn-inner" style = "font-size: 0.8rem; margin-left:60px; margin-top:20px;">';
      						//FICHA DEL PAPER - INI
      						html = html +"<p class='btn-inner'>Autor</p><p style ='margin-left:110px;'>"+data[i].author+"</p>";
      						html = html +"<p class='btn-inner'>Fecha publicación</p><p style ='margin-left:110px;'>"+data[i].published.substring(0, 10)+"</p>";
      						html = html +'<img class="carousel-inner" onclick="clickImage('+data[i].id+');" src="./images/'+data[i].id+'.jpg" style="width: 100%;">';
      						html = html + '<div class="btn-inner" style ="margin-top:20px; font-size: 1.5rem;">';
      						html = html + 'Artículos más similares';
				            html = html + '<div class="col-sm-8e" id ="Cards" style="background-color:#42DCA3; border-radius: 20px; margin: auto; width:60%">'
				            html = html +    '<div id="myCarousel'+i+'" class="carousel slide" data-ride="carousel">'
				            html = html +        '<div id = "carrousel'+i+'">'                    	
				            html = html +        '</div>'

				            html = html +        '<a class="left carousel-control" href="#myCarousel'+i+'" data-slide="prev">'
				            html = html +          '<span class="glyphicon glyphicon-chevron-left"></span>'
				            html = html +          '<span class="sr-only">Previous</span>'
				            html = html +        '</a>'
				            html = html +        '<a class="right carousel-control" href="#myCarousel'+i+'" data-slide="next">'
				            html = html +          '<span class="glyphicon glyphicon-chevron-right"></span>'
				            html = html +          '<span class="sr-only">Next</span>'
				            html = html +        '</a>'
				            html = html +    '</div>'
				            html = html + '</div>' 
				            html = html + '</div>'
							html = html + '</div>'

      						html = html + '</div>'

      						
						}
						var psr = '#resultados';
						$(psr).show();
						document.getElementById("papersFound").innerHTML = html;
						searchResults = data;
						for (i = 0; i < data.length; ++i) $('#paper'+i).hide();
						window.location.hash = "resultados";
					}
			}
			})*/	    	
	    }
	    function filtrar(){
	    	var fechaDesde = document.getElementById("fechaDesde").value;
	    	var fechaHasta = document.getElementById("fechaHasta").value;
	    	var texto = document.getElementById("texto").value;
	    	var autor = document.getElementById("autor").value;;
	    	var query = "";
	    	if (fechaDesde != "") query = query+'from='+fechaDesde+"&";
	    	if (fechaHasta != "") query = query+'to='+fechaHasta+"&";
	    	if (autor != "") query = query+'autor='+autor+"&";
	    	if (texto != "") query = query+'text='+texto+"&";
	    	if (query == ""){
	    		alert("Se debe informar algún criterio de filtrado.")
	    	}else{
		    	var url = 'http://localhost:3000/query?'+query;
				jQuery.support.cors = true;
				$.ajax ({
					url: url,
					datatype: "json",
					crossDomain: true,
					success: function (data) {
						var i;
						var html = "";
						for (i = 0; i < data.length; ++i){
							html = html + '<div onmouseover="showPaper('+i+', \''+data[i].id+'\');" onmouseout="hidePaper('+i+');"  id = "'+data[i].id+'" class="btn-inner" style ="margin-top:20px; font-size: 3rem;">';
      						html = html + '· '+data[i].title;
      						html = html + '<div id="paper'+i+'" class="btn-inner" style = "font-size: 0.8rem; margin-left:60px; margin-top:20px;">';
      						//FICHA DEL PAPER - INI
      						html = html +"<p class='btn-inner'>Autor</p><p style ='margin-left:110px;'>"+data[i].author+"</p>";
      						html = html +"<p class='btn-inner'>Fecha publicación</p><p style ='margin-left:110px;'>"+data[i].published.substring(0, 10)+"</p>";
      						html = html +'<img class="carousel-inner" onclick="clickImage('+data[i].id+');" src="./images/'+data[i].id+'.jpg" style="width: 100%;">';
      						html = html + '<div class="btn-inner" style ="margin-top:20px; font-size: 1.5rem;">';
      						html = html + 'Artículos más similares';
				            html = html + '<div class="col-sm-8e" id ="Cards" style="background-color:#42DCA3; border-radius: 20px; margin: auto; width:60%">'
				            html = html +    '<div id="myCarousel'+i+'" class="carousel slide" data-ride="carousel">'
				            html = html +        '<div id = "carrousel'+i+'">'                    	
				            html = html +        '</div>'

				            html = html +        '<a class="left carousel-control" href="#myCarousel'+i+'" data-slide="prev">'
				            html = html +          '<span class="glyphicon glyphicon-chevron-left"></span>'
				            html = html +          '<span class="sr-only">Previous</span>'
				            html = html +        '</a>'
				            html = html +        '<a class="right carousel-control" href="#myCarousel'+i+'" data-slide="next">'
				            html = html +          '<span class="glyphicon glyphicon-chevron-right"></span>'
				            html = html +          '<span class="sr-only">Next</span>'
				            html = html +        '</a>'
				            html = html +    '</div>'
				            html = html + '</div>' 
				            html = html + '</div>'
							html = html + '</div>'

      						html = html + '</div>'

      						
						}
						var psr = '#resultados';
						$(psr).show();
						document.getElementById("papersFound").innerHTML = html;
						searchResults = data;
						for (i = 0; i < data.length; ++i) $('#paper'+i).hide();
						window.location.hash = "resultados";
					}
				})
			}
	    }
    </script>
  </head>

  <body id="page-top" background="background.png">
   <div id="papers" class="content-section text-center" style ="margin-bottom: 1px">
      <div class="container">
        <div class="row">
       		<h4 style = "font-size: 400%;">BIENVENIDO A SCIFLIX</h4>
          <div class="col-lg-8e mx-auto">
            <h2 style = "font-size: 200%;">Recomendados para ti</h2>


            <!-- The slideshow -->
            <div class="col-sm-8e" id ="Cards" style="background-color:#42DCA3; border-radius: 20px; margin: auto; width:60%">
                <div id="myCarousel" class="carousel slide" data-ride="carousel">
                    <div id = "carrousel">                    	
                    </div>
                    <!-- Left and right controls -->
                    <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                      <span class="glyphicon glyphicon-chevron-left"></span>
                      <span class="sr-only">Previous</span>
                    </a>
                    <a class="right carousel-control" href="#myCarousel" data-slide="next">
                      <span class="glyphicon glyphicon-chevron-right"></span>
                      <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="Sector1 " class="content-section" style="margin-top: 1px">
     	<div class="container">
     	<div class="dropdown" style="margin: 10px;font-size: 200%;">FILTRO DE BÚSQUEDA</div>
        <div class="dropdown" style="min-width: 850px;border: 1px; border-color: white; border-style: solid; padding: 10px; width: 100%;">
        	<div style = "width: 33%; float: left;">
	    		<div style="margin: 10px;font-size: 100%;">VER DESDE</div>
	    		<input type="date" id="fechaDesde" class="btn-default" >
	    		<div style="margin: 10px;font-size: 100%;">HASTA</div>
	    		<input type="date" id="fechaHasta" class="btn-default">
    		</div>
    		<div style = "width: 33%;float: left;">
	    		<div style="margin: 10px;font-size: 100%;">AUTOR</div>
	    		<input type="text" id="autor" class="btn-default" >
	    		<div style="margin: 10px;font-size: 100%;">TEXTO</div>
	    		<input type="text" id="texto" class="btn-default">
    		</div>
    		<div style = "width: 33%;float: right;">
	    		<div style="margin: 10px;font-size: 100%;">CATEGORÍA</div>
	    		<label class="btn-default" style = "width: 100%; border-style: none"><input type="checkbox" name="cb1"> MACHINE LEARNING</label>
	    		<label class="btn-default" style = "width: 100%;border-style: none"><input type="checkbox" name="cb2"> ARTIFICIAL INTELIGENCE</label>
	    		<label class="btn-default" style = "width: 100%;border-style: none"><input type="checkbox" name="cb3"> CRYPTOGRAPHY</label>
    		</div>
    		  		
    		<div style = "width: 100%; float:right;">
    		<button id="btnSubmit" class="btn-default" onclick="filtrar()" style="margin:50px;float:right;">Filtrar</button>
    		</div>

    	</div>
    	<div class = "dropdown">
			<label>Buscar similares a un artículo:<input id="fileInput" type="file" onchange="searchSimilar()"></label>
		</div>  
        <div class="row">
          <!-- Left Col -->
          	<div class="col-sm-4">
	            <div class="dropdown">
	            	<br>
	            	<div style="margin: 10px;font-size: 200%;">CATEGORÍAS</div><br>
	            	<div onmouseover="showTopic('ML');" onmouseout="hideTopic('ML');" >
			            <div id = "category" class="btn-default" tag = "ML" style = "padding: 10px;text-align: center;">
			            	MACHINE LEARNING
			            </div>
						<div id = "topicsML" class="btn-inner ">
							<a href="#">Topic 1</a><br>
							<a href="#">Topic 2</a><br>
							<a href="#">Topic 3</a><br>
						</div>
						<script>$('#topicsML').hide();</script>
					</div>
					<div onmouseover="showTopic('AI');" onmouseout="hideTopic('AI');" >
						<div id = "category" class="btn-default" tag = "AI" style = "padding: 10px;text-align: center;">
							ARTIFICIAL INTELIGENCE
						</div>
						<div id = "topicsAI" class="btn-inner">
							<a href="#">Topic 1</a><br>
							<a href="#">Topic 2</a><br>
							<a href="#">Topic 3</a><br>
						</div>
						<script>$('#topicsAI').hide();</script>
					</div>
	            </div>
            </div>

            
      	</div>
      	<div class="dropdown" id="resultados">
      		<div style="margin: 10px;font-size: 200%;">RESULTADOS BÚSQUEDA</div><br>
      		<div id ="papersFound">
      		</div>
      	</div>
    </div>
    </div>

  

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Google Maps API Key - Use your own API key to enable the map feature. More information on the Google Maps API can be found at https://developers.google.com/maps/ -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRngKslUGJTlibkQ3FkfTxj3Xss1UlZDA&sensor=false"></script>

    <!-- Custom scripts for this template -->
    <script src="js/grayscale.min.js"></script>

  </body>

</html>
